#include "egdb/egdb_intl.h"
#include <cstdio>
#include <cstdlib>

using namespace egdb_interface;

#define DB_PATH "C:/db_intl/wld_v2"

typedef struct {
	EGDB_POSITION pos;
	int color;
	int value;
} POS_VALUE;

POS_VALUE positions[] = {
	{0x0000000008000000, 0x0000000000000002, 0x0000000008000002, EGDB_BLACK, EGDB_DRAW},
	{0x0000000008000000, 0x0000000000000002, 0x0000000008000002, EGDB_WHITE, EGDB_DRAW},
	{0x0000000008000000, 0x0000000020000000, 0x0000000008000000, EGDB_BLACK, EGDB_WIN},
	{0x0000000008000000, 0x0000000020000000, 0x0000000008000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000000004000, 0x0000000200000000, 0x0000000000000000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000000004000, 0x0000000200000000, 0x0000000000000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000004000040000, 0x0000000020000000, 0x0000004020040000, EGDB_BLACK, EGDB_DRAW},
	{0x0000004000040000, 0x0000000020000000, 0x0000004020040000, EGDB_WHITE, EGDB_DRAW},
	{0x0000004080000000, 0x0000000020000000, 0x0000004080000000, EGDB_BLACK, EGDB_WIN},
	{0x0000004080000000, 0x0000000020000000, 0x0000004080000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000009000000, 0x0000000200000000, 0x0000000208000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000000009000000, 0x0000000800000000, 0x0000000808000000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000020002000, 0x0000000200000000, 0x0000000020000000, EGDB_BLACK, EGDB_WIN},
	{0x0000000020002000, 0x0000000200000000, 0x0000000020000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000080008000, 0x0000000000000002, 0x0000000000000002, EGDB_BLACK, EGDB_DRAW},
	{0x0000000080008000, 0x0000000000000004, 0x0000000000000004, EGDB_WHITE, EGDB_WIN},
	{0x0000004000020000, 0x0000001000000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000004000020000, 0x0000001000000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000004000040000, 0x000000a000000000, 0x000000e000040000, EGDB_BLACK, EGDB_DRAW},
	{0x0000004000040000, 0x000000a000000000, 0x000000e000040000, EGDB_WHITE, EGDB_DRAW},
	{0x0000004080000000, 0x0000000020000004, 0x0000004080000004, EGDB_BLACK, EGDB_DRAW},
	{0x0000004080000000, 0x0000000020000004, 0x0000004080000004, EGDB_WHITE, EGDB_DRAW},
	{0x0000000000000082, 0x0000000000180000, 0x0000000000000082, EGDB_WHITE, EGDB_DRAW},
	{0x0000000000010020, 0x0000000000180000, 0x0000000000010020, EGDB_BLACK, EGDB_WIN},
	{0x0000000040002000, 0x0000000200400000, 0x0000000040400000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000040002000, 0x0000000200400000, 0x0000000040400000, EGDB_WHITE, EGDB_DRAW},
	{0x0000010000000800, 0x0001000000400000, 0x0000010000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000200001000, 0x0001000000400000, 0x0000000200000000, EGDB_BLACK, EGDB_WIN},
	{0x0000800000000100, 0x000000000a000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000800000000100, 0x000000000a000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000048400000000, 0x0000000000000004, 0x0000048400000004, EGDB_BLACK, EGDB_DRAW},
	{0x0000048400000000, 0x0000000000000004, 0x0000048400000004, EGDB_WHITE, EGDB_DRAW},
	{0x0000100000003000, 0x0000000020000000, 0x0000100000003000, EGDB_WHITE, EGDB_LOSS},
	{0x0000200000000088, 0x0000000020000000, 0x0000200000000088, EGDB_BLACK, EGDB_WIN},
	{0x0000004081000000, 0x0000000000000004, 0x0000004080000004, EGDB_BLACK, EGDB_DRAW},
	{0x0000004081000000, 0x0000000000000004, 0x0000004080000004, EGDB_WHITE, EGDB_DRAW},
	{0x0000010000002200, 0x0000000200000000, 0x0000010000000200, EGDB_BLACK, EGDB_WIN},
	{0x0000010000002200, 0x0000000200000000, 0x0000010000000200, EGDB_WHITE, EGDB_LOSS},
	{0x0000000080008001, 0x0008000000000000, 0x0008000000000001, EGDB_BLACK, EGDB_DRAW},
	{0x0000000080008002, 0x0001000000000000, 0x0001000000000002, EGDB_WHITE, EGDB_DRAW},
	{0x0000004001040000, 0x0000001000000000, 0x0000000001000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000004000088000, 0x0000001000000000, 0x0000000000008000, EGDB_BLACK, EGDB_WIN},
	{0x0000000404100000, 0x0000000000001000, 0x0000000000001000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000404100000, 0x0000000000001000, 0x0000000000001000, EGDB_WHITE, EGDB_DRAW},
	{0x0000028000008000, 0x0000010000000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000028000008000, 0x0000010000000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000048800000000, 0x0000000000000003, 0x0000048800000003, EGDB_BLACK, EGDB_DRAW},
	{0x0000049000000000, 0x0000000000140000, 0x0000049000140000, EGDB_WHITE, EGDB_DRAW},
	{0x0000100000008008, 0x0000000020000080, 0x0000100000008088, EGDB_WHITE, EGDB_DRAW},
	{0x0000200000042000, 0x0000000020004000, 0x0000200000046000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000000000288, 0x0000000000180000, 0x0000000000000288, EGDB_WHITE, EGDB_DRAW},
	{0x0000000010040001, 0x0000000000180000, 0x0000000010040001, EGDB_BLACK, EGDB_WIN},
	{0x0000004201000000, 0x000000000a000000, 0x000000420a000000, EGDB_BLACK, EGDB_DRAW},
	{0x0000005001000000, 0x0000000802000000, 0x0000005802000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000040000002040, 0x0000000200400000, 0x0000040000400040, EGDB_BLACK, EGDB_DRAW},
	{0x0000040000002040, 0x0000000200400000, 0x0000040000400040, EGDB_WHITE, EGDB_DRAW},
	{0x0000100000000804, 0x0001000000400000, 0x0000100000000004, EGDB_WHITE, EGDB_LOSS},
	{0x0000004002001000, 0x0001000000400000, 0x0000004002000000, EGDB_BLACK, EGDB_WIN},
	{0x0000000080008001, 0x0000200000000100, 0x0000200000000101, EGDB_BLACK, EGDB_DRAW},
	{0x0000000080008001, 0x0000200000000100, 0x0000200000000101, EGDB_WHITE, EGDB_DRAW},
	{0x0000004400010000, 0x0000001800000000, 0x0000000c00000000, EGDB_BLACK, EGDB_DRAW},
	{0x0000004400010000, 0x0000001800000000, 0x0000000c00000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000610000000000, 0x0000000005000000, 0x0000200000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000610000000000, 0x0000000005000000, 0x0000200000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000404100000, 0x0000000000800020, 0x0000000000800020, EGDB_BLACK, EGDB_DRAW},
	{0x0000000404100000, 0x0000000000800020, 0x0000000000800020, EGDB_WHITE, EGDB_WIN},
	{0x0000028000008000, 0x0000010000000001, 0x0000000000000001, EGDB_BLACK, EGDB_DRAW},
	{0x0000028000008000, 0x0000010000000001, 0x0000000000000001, EGDB_WHITE, EGDB_DRAW},
	{0x0000040080040000, 0x0010000008000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000040080040000, 0x0010000008000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000400024100000, 0x0010000000000000, 0x0010400024100000, EGDB_BLACK, EGDB_WIN},
	{0x0000400028000001, 0x0000000040000000, 0x0000400068000001, EGDB_WHITE, EGDB_LOSS},
	{0x0000401000090000, 0x0000000020000000, 0x0000401000090000, EGDB_WHITE, EGDB_LOSS},
	{0x0000401040000080, 0x0000000020000000, 0x0000401040000080, EGDB_BLACK, EGDB_WIN},
	{0x0000100001008008, 0x0000000000000080, 0x0000100000008088, EGDB_BLACK, EGDB_WIN},
	{0x0000100001008008, 0x0000000000000080, 0x0000100000008088, EGDB_WHITE, EGDB_LOSS},
	{0x0000100080102000, 0x0000000200000000, 0x0000100080100000, EGDB_BLACK, EGDB_WIN},
	{0x0000100080102000, 0x0000000200000000, 0x0000100080100000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000080008202, 0x0000040000000000, 0x0000040000000202, EGDB_BLACK, EGDB_WIN},
	{0x0000000080008202, 0x0000040000000000, 0x0000040000000202, EGDB_WHITE, EGDB_LOSS},
	{0x0000204000010004, 0x0000001000000000, 0x0000200000000004, EGDB_BLACK, EGDB_WIN},
	{0x0000204000010004, 0x0000001000000000, 0x0000200000000004, EGDB_WHITE, EGDB_LOSS},
	{0x0000000404100080, 0x0000000000000001, 0x0000000000000081, EGDB_BLACK, EGDB_WIN},
	{0x0000000404100080, 0x0000000000000001, 0x0000000000000081, EGDB_WHITE, EGDB_DRAW},
	{0x0000028000008001, 0x0000010000000000, 0x0000000000000001, EGDB_BLACK, EGDB_WIN},
	{0x0000028000008001, 0x0000010000000000, 0x0000000000000001, EGDB_WHITE, EGDB_LOSS},
	{0x0000000444000200, 0x0000000000000800, 0x0000000000000800, EGDB_BLACK, EGDB_DRAW},
	{0x0000000444000200, 0x0000000000000800, 0x0000000000000800, EGDB_WHITE, EGDB_DRAW},
	{0x0000000890002000, 0x0000400000000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000000890002000, 0x0000400000000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000048400000000, 0x0000002002000008, 0x000004a402000008, EGDB_BLACK, EGDB_DRAW},
	{0x0000048400000000, 0x0002004020000000, 0x000204c420000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000100000004020, 0x0000000020008080, 0x000010000000c0a0, EGDB_WHITE, EGDB_DRAW},
	{0x0000100040004000, 0x0010000420000000, 0x0010100440004000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000000021008, 0x0000000008180000, 0x0000000008021008, EGDB_BLACK, EGDB_WIN},
	{0x0000000000021008, 0x0000000008180000, 0x0000000008021008, EGDB_WHITE, EGDB_DRAW},
	{0x0000000050000010, 0x0000000020028000, 0x0000000050000010, EGDB_WHITE, EGDB_LOSS},
	{0x0002000000004002, 0x0000000008028000, 0x0002000000004002, EGDB_BLACK, EGDB_WIN},
	{0x0000008008002000, 0x0000400200000800, 0x0000408008000800, EGDB_BLACK, EGDB_WIN},
	{0x0001100000002000, 0x0000000200100040, 0x0001100000100040, EGDB_WHITE, EGDB_DRAW},
	{0x0000100000000810, 0x0003000000400000, 0x0002100000000010, EGDB_BLACK, EGDB_WIN},
	{0x0000000200102000, 0x0001000000400020, 0x0000000200100020, EGDB_WHITE, EGDB_DRAW},
	{0x0000000001040100, 0x0004000008010000, 0x0000000001000100, EGDB_BLACK, EGDB_WIN},
	{0x0000000001040100, 0x0004000008010000, 0x0000000001000100, EGDB_WHITE, EGDB_LOSS},
	{0x0000400800000004, 0x0000000005000008, 0x000000000000000c, EGDB_BLACK, EGDB_DRAW},
	{0x0000400800000004, 0x0000000005000008, 0x000000000000000c, EGDB_WHITE, EGDB_DRAW},
	{0x0000501000000000, 0x0000000011040000, 0x0000001000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000501000000000, 0x0000000011040000, 0x0000001000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000c02000000000, 0x0000001800100000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000c02000000000, 0x0000001800100000, 0x0000000000000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000400026000000, 0x0000000000040100, 0x0000400026040100, EGDB_WHITE, EGDB_DRAW},
	{0x0000400028002000, 0x0020000000000001, 0x0020400028002001, EGDB_BLACK, EGDB_DRAW},
	{0x0000401008000100, 0x0000002020000000, 0x0000403008000100, EGDB_BLACK, EGDB_WIN},
	{0x0000401008000100, 0x0000002020000000, 0x0000403008000100, EGDB_WHITE, EGDB_LOSS},
	{0x0000000008800210, 0x0000000000180000, 0x0000000008800210, EGDB_WHITE, EGDB_LOSS},
	{0x0008020000010001, 0x0000000000180000, 0x0008020000010001, EGDB_BLACK, EGDB_WIN},
	{0x0000100001004020, 0x0000000000008080, 0x000010000000c0a0, EGDB_BLACK, EGDB_DRAW},
	{0x0000100001004020, 0x0000000000008080, 0x000010000000c0a0, EGDB_WHITE, EGDB_DRAW},
	{0x00002000000020a0, 0x0000020200000000, 0x00002200000000a0, EGDB_WHITE, EGDB_LOSS},
	{0x0000420400002000, 0x0000000200000004, 0x0000420400000004, EGDB_BLACK, EGDB_WIN},
	{0x0000004000001110, 0x0001000000400000, 0x0000004000000110, EGDB_BLACK, EGDB_WIN},
	{0x0000004000001110, 0x0001000000400000, 0x0000004000000110, EGDB_WHITE, EGDB_LOSS},
	{0x0000000080008050, 0x0002004000000000, 0x0002004000000050, EGDB_BLACK, EGDB_DRAW},
	{0x0000000080008050, 0x0002004000000000, 0x0002004000000050, EGDB_WHITE, EGDB_DRAW},
	{0x0000204000010010, 0x0002001000000000, 0x0002200000000010, EGDB_BLACK, EGDB_WIN},
	{0x0000204000010010, 0x0002001000000000, 0x0002200000000010, EGDB_WHITE, EGDB_LOSS},
	{0x0000400800000802, 0x0000000005000000, 0x0000000000000802, EGDB_BLACK, EGDB_WIN},
	{0x0000400800000802, 0x0000000005000000, 0x0000000000000802, EGDB_WHITE, EGDB_LOSS},
	{0x0000000404100004, 0x0000002040000000, 0x0000002040000004, EGDB_BLACK, EGDB_DRAW},
	{0x0000000404110000, 0x0001002000000000, 0x0001002000010000, EGDB_WHITE, EGDB_DRAW},
	{0x0000028040002000, 0x0000010000100000, 0x0000000000102000, EGDB_BLACK, EGDB_DRAW},
	{0x0000030000008200, 0x0000008000000004, 0x0000000000008004, EGDB_WHITE, EGDB_DRAW},
	{0x0000044800000080, 0x0010000008000000, 0x0000000800000000, EGDB_BLACK, EGDB_WIN},
	{0x0000044800000080, 0x0010000008000000, 0x0000000800000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000444000040, 0x0000440000000000, 0x0000440000000000, EGDB_BLACK, EGDB_DRAW},
	{0x0000000448000100, 0x0000022000000000, 0x0000022000000000, EGDB_WHITE, EGDB_WIN},
	{0x00000008c0010000, 0x0000404000000000, 0x0000004000000000, EGDB_BLACK, EGDB_DRAW},
	{0x00000008c0010000, 0x0000404000000000, 0x0000004000000000, EGDB_WHITE, EGDB_DRAW},
	{0x0000204200040000, 0x0020000080000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000204200040000, 0x0020000080000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000900a00008000, 0x0000000000000080, 0x0000900a00008080, EGDB_BLACK, EGDB_WIN},
	{0x0000900a00008000, 0x0000000000000080, 0x0000900a00008080, EGDB_WHITE, EGDB_LOSS},
	{0x0000c00080402000, 0x0000000020000000, 0x0000c00080402000, EGDB_WHITE, EGDB_LOSS},
	{0x0001000004108100, 0x0000000020000000, 0x0001000004108100, EGDB_BLACK, EGDB_WIN},
	{0x0000400801401000, 0x0000002000000000, 0x0000402800401000, EGDB_BLACK, EGDB_WIN},
	{0x0000400801401000, 0x0000002000000000, 0x0000402800401000, EGDB_WHITE, EGDB_LOSS},
	{0x0000460002002000, 0x0000000200000000, 0x0000460002000000, EGDB_BLACK, EGDB_WIN},
	{0x0000460002002000, 0x0000000200000000, 0x0000460002000000, EGDB_WHITE, EGDB_LOSS},
	{0x000000008000b002, 0x0000000000000001, 0x0000000000003003, EGDB_BLACK, EGDB_WIN},
	{0x0000000082028001, 0x0000100000000000, 0x0000100002020001, EGDB_WHITE, EGDB_LOSS},
	{0x0000104000011004, 0x0000001000000000, 0x0000100000001004, EGDB_WHITE, EGDB_LOSS},
	{0x000000c000020110, 0x0000001000000000, 0x0000008000000110, EGDB_BLACK, EGDB_WIN},
	{0x0000000404101002, 0x0000000000002000, 0x0000000000003002, EGDB_WHITE, EGDB_LOSS},
	{0x0000000484102000, 0x0000000000000001, 0x0000000080002001, EGDB_BLACK, EGDB_WIN},
	{0x0000028000820100, 0x0000010000000000, 0x0000000000800100, EGDB_BLACK, EGDB_WIN},
	{0x0000028000820100, 0x0000010000000000, 0x0000000000800100, EGDB_WHITE, EGDB_LOSS},
	{0x0000004444000200, 0x0001000000000000, 0x0001004000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000002444002000, 0x0008000000000000, 0x0008002000000000, EGDB_WHITE, EGDB_LOSS},
	{0x00000048c0010000, 0x0000400000000000, 0x0000004000000000, EGDB_BLACK, EGDB_WIN},
	{0x00000048c0010000, 0x0000400000000000, 0x0000004000000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000000085084000, 0x0000000008000000, 0x0000000008000000, EGDB_BLACK, EGDB_WIN},
	{0x0000000085084000, 0x0000000008000000, 0x0000000008000000, EGDB_WHITE, EGDB_LOSS},
	{0x0000014008001100, 0x0008000000000000, 0x0000000000000000, EGDB_BLACK, EGDB_WIN},
	{0x0000014008001100, 0x0008000000000000, 0x0000000000000000, EGDB_WHITE, EGDB_LOSS},
};


void print_msgs(char const *msg)
{
	std::printf("%s", msg);
}


int main(int argc, char* argv[])
{
	int i, value, nerrors;
	EGDB_DRIVER *handle;

	/* Open the endgame db drivers for 6 pieces max. */
	handle = egdb_open("maxpieces=6", 1000, DB_PATH, print_msgs);
	if (!handle) {
		std::printf("Cannot open egdb driver at %s\n", DB_PATH);
		return(1);
	}

	nerrors = 0;
	std::printf("Testing %zd positions.\n", sizeof(positions) / sizeof(positions[0]));
	for (i = 0; i < sizeof(positions) / sizeof(positions[0]); ++i) {
		value = egdb_lookup(handle, &positions[i].pos, positions[i].color, 0);
		if (value != positions[i].value) {
			std::printf("%d: lookup error, expected %d, got %d\n", i, value, positions[i].value);
			++nerrors;
		}
	}

	std::printf("Test complete, %d errors.\n", nerrors);
	egdb_close(handle);
	return 0;
}


